<?xml version="1.0" encoding="UTF-8" ?>

<!-- DTD 선언 -->
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 
	mapper라는 영역 안에 구문을 작성한다
	- namespace : mapper간의 충돌을 방지 하기 위한 이름 (필수)
-->
<mapper namespace="sch">

	<select id="selectList" parameterType="String"  resultType="sch_unit">
		select *
 		  from sch_unit
		  join sch_unit_join on (sch_unit_code = sch_join_code)
 		 where sch_join_emp = #{id}
	</select>
	
	<select id="selectMap" parameterType="map" resultMap="selectMapList">
		select sch_unit_code,
			   sch_unit_name,
			   sch_unit_aday,
			   sch_unit_sdat,
			   sch_unit_edat,
			   SCH_UNIT_RPT,
			   SCH_UNIT_ERPT,
			   SCH_UNIT_CONT,
			   SCH_UNIT_SEC,
			   SCH_UNIT_STAT,
			   SCH_UNIT_WRTR,
			   SCH_UNIT_WDAT,
			   SCH_UNIT_MDAT,
			   SCH_UNIT_HUE,
			   sch_join_emp,
			   emp_info_name,
			   sch_unit_group_code,
			   sch_group_name
 		  from sch_unit
		  join sch_unit_join on (sch_unit_code = sch_join_code)
		  join emp_info on (sch_unit_wrtr = emp_info_emp_no)
		  join sch_group on (sch_unit_group_code = sch_group_code)
 		 where sch_join_emp = #{id}
 		   and sch_unit_stat = 'Y'
 		   and (sch_unit_sdat between #{start} and #{end}
 		   or sch_unit_edat between #{start} and #{end}) 		   
	</select>
	
	<resultMap type="schAjax" id="selectMapList">
		<result column="sch_unit_code" property="id"/>
		<result column="sch_unit_name" property="title"/>
		<result column="sch_unit_aday" property="allDay"/>
		<result column="sch_unit_sdat" property="start"/>
		<result column="sch_unit_edat" property="end"/>
		<result column="SCH_UNIT_RPT" property="repeat"/>
		<result column="SCH_UNIT_ERPT" property="endRepeat"/>
		<result column="SCH_UNIT_CONT" property="content"/>
		<result column="SCH_UNIT_SEC" property="security"/>
		<result column="SCH_UNIT_STAT" property="stat"/>
		<result column="SCH_UNIT_WRTR" property="writer"/>
		<result column="SCH_UNIT_WDAT" property="writeDate"/>
		<result column="SCH_UNIT_MDAT" property="modifyDate"/>
		<result column="SCH_UNIT_HUE" property="backgroundColor"/>
		<result column="emp_info_name" property="writerName"/>
		<result column="sch_group_name" property="groupName"/>
		
	</resultMap>
	
	<select id="seq" resultType="String">
		select schn_seq.nextval from dual
	</select>
	
	<insert id="insert" parameterType="map">
		Insert into SCH_UNIT (SCH_UNIT_CODE
							 ,SCH_UNIT_NAME
							 ,SCH_UNIT_SDAT
							 ,SCH_UNIT_EDAT
							 ,SCH_UNIT_ADAY
							 ,SCH_UNIT_CONT
							 ,SCH_UNIT_WDAT
							 ,SCH_UNIT_STAT
							 ,SCH_UNIT_WRTR
							 ,SCH_UNIT_HUE
							 ,SCH_UNIT_GROUP_CODE) values ('SCHN'||TRIM(TO_CHAR(#{seq},'000000'))
							 					   ,#{title}
							 					   ,to_date(#{start},'RRMMDDHH24MISS')
							 					   ,to_date(#{end},'RRMMDDHH24MISS')
							 					   ,#{allDay}
							 					   ,#{content}
							 					   ,sysdate
							 					   ,'Y'
							 					   ,#{id}
							 					   ,#{backgroundColor}
							 					   ,#{groupCode})
	</insert>
	
	
	<insert id="insertJoinTable" parameterType="map">
		insert into sch_unit_join values('SCHN'||TRIM(TO_CHAR(#{seq},'000000')), #{id})
	
	</insert>
	
	<!-- 삭제를 담당하는 update -->
	<update id="delete" parameterType="String">
		update sch_unit set sch_unit_stat = 'N' where sch_unit_code = #{value}
	</update>	
	
	<update id="update" parameterType="map">
		update sch_unit set sch_unit_name = #{title}
						  , sch_unit_sdat = to_date(#{start},'RRMMDDHH24MISS')
						  , sch_unit_edat = to_date(#{end},'RRMMDDHH24MISS')
						  , sch_unit_aday = #{allDay}
						  , sch_unit_hue  = #{backgroundColor}
						  , sch_unit_cont = #{content}
						  , sch_unit_mdat = default
					  where sch_unit_code = #{code}
	</update>
	
	<select id="selectMap_min" parameterType="map" resultMap="selectMapList_min">
		select sch_unit_code,
			   sch_unit_name,
			   decode(sch_unit_aday, 'Y', 'true', 'false') as sch_unit_aday,
			   sch_unit_sdat,
			   sch_unit_edat
 		  from sch_unit
		  join sch_unit_join on (sch_unit_code = sch_join_code)
 		 where sch_join_emp = #{id}
 		   and sch_unit_stat = 'Y'
 		   and (sch_unit_sdat between #{start} and #{end}
 		   or sch_unit_edat between #{start} and #{end})
 		   	
	</select>
	
	<resultMap type="schAjax_min" id="selectMapList_min">
		<result column="sch_unit_code" property="id"/>
		<result column="sch_unit_name" property="title"/>
		<result column="sch_unit_aday" property="allDay"/>
		<result column="sch_unit_sdat" property="start"/>
		<result column="sch_unit_edat" property="end"/>
		
	</resultMap>
</mapper>