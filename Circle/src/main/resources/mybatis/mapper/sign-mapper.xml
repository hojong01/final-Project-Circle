<?xml version="1.0" encoding="UTF-8" ?>

<!-- DTD 선언 -->
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sign">
<!--  -->
<!-- signList page mapper start -->
	<select id="list" resultType="signList">
		SELECT SI.SIGN_CODE
			 , ST.SIGN_TYPE_NAME
    		 , SI.SIGN_TITLE
    		 , EI.EMP_INFO_NAME
    		 , JI.JOB_INFO_NAME
    		 , TO_CHAR(SI.SIGN_WDAT, 'yyyy-mm-dd') AS SIGN_WDAT
             , TO_CHAR(SI.SIGN_WDAT, 'hh:dd') AS SIGN_WHOUR
    		 , TO_CHAR(SI.SIGN_EDAT, 'yyyy-mm-dd') AS SIGN_EDAT
             , TO_CHAR(SI.SIGN_EDAT, 'hh:dd') AS SIGN_EHOUR
             , SI.SIGN_STEP
             , SI.SIGN_COUNT
 		  FROM SIGN SI
 		  JOIN EMP_INFO EI ON (EI.EMP_INFO_EMP_NO = SI.SIGN_EMP_CODE)
 		  JOIN JOB_INFO JI ON (JI.JOB_INFO_CODE = EI.EMP_INFO_JOB_CODE)
  		  JOIN SIGN_TYPE ST ON (ST.SIGN_TYPE_CODE = SI.SIGN_TYPE_CODE)
 		 WHERE SI.SIGN_EDAT IS NULL
 		   AND SI.SIGN_EMP_CODE = '200101090031'
 		 ORDER BY SI.SIGN_CODE DESC
	</select>
		
	<select id="listComplete" resultType="signList">
		SELECT SI.SIGN_CODE
			 , ST.SIGN_TYPE_NAME
    		 , SI.SIGN_TITLE
    		 , EI.EMP_INFO_NAME
    		 , JI.JOB_INFO_NAME
    		 , TO_CHAR(SI.SIGN_WDAT, 'yyyy-mm-dd') AS SIGN_WDAT
             , TO_CHAR(SI.SIGN_WDAT, 'hh:dd') AS SIGN_WHOUR
    		 , TO_CHAR(SI.SIGN_EDAT, 'yyyy-mm-dd') AS SIGN_EDAT
             , TO_CHAR(SI.SIGN_EDAT, 'hh:dd') AS SIGN_EHOUR
             , SI.SIGN_STEP
             , SI.SIGN_COUNT
 		  FROM SIGN SI
 		  JOIN EMP_INFO EI ON (EI.EMP_INFO_EMP_NO = SI.SIGN_EMP_CODE)
 		  JOIN JOB_INFO JI ON (JI.JOB_INFO_CODE = EI.EMP_INFO_JOB_CODE)
  		  JOIN SIGN_TYPE ST ON (ST.SIGN_TYPE_CODE = SI.SIGN_TYPE_CODE)
 		 WHERE SI.SIGN_EDAT IS NOT NULL
 		   AND SI.SIGN_EMP_CODE = '200101090031'
 		 ORDER BY SI.SIGN_CODE DESC
	</select>
	
<!-- 	<select id="count" resultType="int" parameterType="string">
		 SELECT COUNT(*)
  		   FROM (SELECT SI.SIGN_CODE
     				  , SJ.SIGN_JOIN_TYPE
     				  , SJ.SIGN_JOIN_CHECK
  				   FROM SIGN SI
  				   JOIN SIGN_JOIN SJ ON(SJ.SIGN_CODE = SI.SIGN_CODE)
 				  WHERE SJ.SIGN_JOIN_TYPE = 'Y'
   					AND SJ.SIGN_JOIN_CHECK = 'N'
   					AND SI.SIGN_CODE = #{signCode})
	</select> -->
	
	<select id="signJoinerCheck" resultType="signListJoiner">
		SELECT EI.EMP_INFO_NAME
     		 , JI.JOB_INFO_NAME
  		  FROM SIGN SI
 		  JOIN SIGN_JOIN SJ ON(SJ.SIGN_CODE = SI.SIGN_CODE)
  		  JOIN EMP_INFO EI ON(EI.EMP_INFO_EMP_NO = SJ.SIGN_JOIN_EMP_CODE)
  		  JOIN JOB_INFO JI ON(JI.JOB_INFO_CODE = EI.EMP_INFO_JOB_CODE)
 		 WHERE SJ.SIGN_JOIN_TYPE = 'Y'
   		   AND SJ.SIGN_JOIN_CHECK = 'N'
   		   AND SI.SIGN_CODE = #{signCode}
 		 ORDER BY JI.JOB_INFO_CODE ASC	
	</select>
	
  	<select id="signJoiner" resultType="signListJoiner" >
		SELECT EI.EMP_INFO_NAME
     		 , JI.JOB_INFO_NAME
  		  FROM SIGN SI
 		  JOIN SIGN_JOIN SJ ON(SJ.SIGN_CODE = SI.SIGN_CODE)
  		  JOIN EMP_INFO EI ON(EI.EMP_INFO_EMP_NO = SJ.SIGN_JOIN_EMP_CODE)
  		  JOIN JOB_INFO JI ON(JI.JOB_INFO_CODE = EI.EMP_INFO_JOB_CODE)
 		 WHERE SJ.SIGN_JOIN_TYPE = 'Y'
   		   AND SI.SIGN_CODE = #{signCode}
 		 ORDER BY JI.JOB_INFO_CODE ASC
	</select>
	
 	<select id="signWatcher" resultType="signListJoiner" >
		SELECT EI.EMP_INFO_NAME
     		 , JI.JOB_INFO_NAME
  		  FROM SIGN SI
 		  JOIN SIGN_JOIN SJ ON(SJ.SIGN_CODE = SI.SIGN_CODE)
  		  JOIN EMP_INFO EI ON(EI.EMP_INFO_EMP_NO = SJ.SIGN_JOIN_EMP_CODE)
  		  JOIN JOB_INFO JI ON(JI.JOB_INFO_CODE = EI.EMP_INFO_JOB_CODE)
 		 WHERE SJ.SIGN_JOIN_TYPE = 'N'
   		   AND SI.SIGN_CODE = #{signCode}
 		 ORDER BY JI.JOB_INFO_CODE ASC
	</select>
<!-- signList page mapper end -->
	

<!-- signSelectOne page mapper start -->
	<select id="signSelectOne" parameterType="string" resultType="signSelectOne">
		SELECT ST.SIGN_TYPE_NAME
    		 , SI.SIGN_TITLE
             , SI.SIGN_NOTE
    		 , EI.EMP_INFO_NAME
    		 , JI.JOB_INFO_NAME
    		 , TO_CHAR(SI.SIGN_WDAT, 'yyyy-mm-dd') AS SIGN_WDAT
             , TO_CHAR(SI.SIGN_WDAT, 'hh:dd') AS SIGN_WHOUR
    		 , TO_CHAR(SI.SIGN_EDAT, 'yyyy-mm-dd') AS SIGN_EDAT
             , TO_CHAR(SI.SIGN_EDAT, 'hh:dd') AS SIGN_EHOUR
             , SI.SIGN_STEP
             , SI.SIGN_COUNT
 		  FROM SIGN SI
 		  JOIN EMP_INFO EI ON (EI.EMP_INFO_EMP_NO = SI.SIGN_EMP_CODE)
 		  JOIN JOB_INFO JI ON (JI.JOB_INFO_CODE = EI.EMP_INFO_JOB_CODE)
  		  JOIN SIGN_TYPE ST ON (ST.SIGN_TYPE_CODE = SI.SIGN_TYPE_CODE)
 		 WHERE SI.SIGN_CODE = #{signCode}		
	</select>

<!-- signSelectOne page mapper end -->

<!-- signWrite page mapper start -->
	<!-- create one sign case start -->
	<select id="seqSign" resultType="String">
		SELECT SIGN_SEQ.NEXTVAL FROM DUAL
	</select>
	
	<insert id="signWriteAdd" parameterType="map">
		INSERT INTO SIGN VALUES('SIGN'||TRIM(TO_CHAR(#{seqSign},'000000'))
     	          , #{sign_type_code}
      		      , SYSDATE+#{sign_keep}
               	  , #{sign_emp_code}
              	  , #{sign_acc}
                  , #{sign_title}
          	      , #{sign_note}
          	      , #{sign_status}
           	      , SYSDATE
           	      , NULL
                  , 'SIPC000001'
                  , #{sign_count})
	</insert>
	
	
	<select id="seqSignJoiner" resultType="String">
		SELECT SIJC_SEQ.NEXTVAL FROM DUAL
	</select>
	
	<insert id="signJoinerAdd" parameterType="map">
		INSERT INTO SIGN_JOIN VALUES('SIJC'||TRIM(TO_CHAR(#{seqSignJoiner},'000000'))
				  , #{sign_join_emp_code}
				  , #{sign_join_type}
				  , #{sign_join_check}
				  , NULL
				  , #{sign_code})
	</insert>

	<insert id="signProcessAdd1" parameterType="map">
		INSERT INTO SIGN_PROCESS VALUES('SIPC000001'
				  , #{sign_code}
				  , SYSDATE)
	</insert>
	
	<insert id="signProcessAdd2" parameterType="map">
		INSERT INTO SIGN_PROCESS VALUES('SIPC000002'
				  , #{sign_code}
				  , SYSDATE)
	</insert>	
	
	<insert id="signProcessAdd3" parameterType="map">
		INSERT INTO SIGN_PROCESS VALUES('SIPC000003'
				  , #{sign_code}
				  , SYSDATE)
	</insert>	
	<!-- create one sign case end -->


	<select id="signTypeList" resultType="signType">
		SELECT * FROM SIGN_TYPE
	</select>
	
	<select id="signTypeContent" resultType="String">
		SELECT SIGN_TYPE_CONTENT 
		  FROM SIGN_TYPE 
		 WHERE SIGN_TYPE_CODE = #{typeCode}
	</select>
	
	<select id="signEmpList" resultType="signEmpList">
	 	 SELECT EI.EMP_INFO_EMP_NO 
      	 	  , EI.EMP_INFO_NAME
     		  , JI.JOB_INFO_CODE
     		  , JI.JOB_INFO_NAME
              , DI.DEPT_INFO_NAME
              , FI.FILES_ROUTE
  		   FROM EMP_INFO EI
  		   JOIN JOB_INFO JI ON(JI.JOB_INFO_CODE = EI.EMP_INFO_JOB_CODE)
           JOIN DEPT_INFO DI ON(DI.DEPT_INFO_CODE = EI.EMP_INFO_DEPT_CODE)
LEFT OUTER JOIN FILES FI ON(FI.FILES_TYPE = EI.EMP_INFO_EMP_NO)
 	      ORDER BY JI.JOB_INFO_CODE ASC
	</select>
<!-- signWrite page mapper end -->
</mapper>